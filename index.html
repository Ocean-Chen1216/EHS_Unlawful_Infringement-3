<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0288d1">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>MK è·å ´ä¸æ³•ä¾µå®³é é˜²èª¿æŸ¥è¡¨ (é™„ä»¶å››)</title>
<link rel="icon" href="icon-192.png" type="image/png">
<link rel="manifest" href="manifest.json">
<style>
  /* =========================================
     1. æ ¸å¿ƒæ¨£å¼
     ========================================= */
  body { font-family: -apple-system, "Microsoft JhengHei", sans-serif; background: #f0f2f5; margin: 0; padding: 0; color: #333; }
  
  .container { 
      background: white; 
      padding: 20px; 
      margin: 15px auto 100px auto; 
      max-width: 800px;
      border-radius: 10px; 
      box-shadow: 0 2px 10px rgba(0,0,0,0.05); 
  }
  
  .version-tag { text-align: right; font-size: 0.8rem; color: #888; margin-bottom: 5px; }
  .section { margin-bottom: 20px; border: 1px solid #eee; padding: 15px; border-radius: 8px; background: #fff; }
  .section h3 { margin-top: 0; border-bottom: 2px solid #eee; padding-bottom: 10px; font-size: 1.1rem; color: #0288d1; }
  
  /* è¡¨å–®å…ƒä»¶æ¨£å¼ */
  label.block-label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; font-size: 0.95rem; margin-top: 10px;}
  
  input[type="text"], input[type="number"], input[type="date"], select, textarea { 
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; 
      font-size: 16px; margin-bottom: 5px; box-sizing: border-box; background: #fff; 
  }
  
  /* è¡Œå…§è¼¸å…¥æ¡† (å¹´/æœˆ) */
  .inline-input-group { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
  .inline-input { width: 80px !important; margin-bottom: 0 !important; text-align: center; }

  /* é¸é …æŒ‰éˆ•æ¨£å¼ (Radio/Checkbox) */
  .option-group { display: grid; grid-template-columns: 1fr; gap: 8px; margin-bottom: 10px; }
  .option-label { 
      display: flex; align-items: center; padding: 10px; border: 1px solid #ddd; 
      border-radius: 6px; cursor: pointer; transition: all 0.2s; background: #fafafa;
  }
  .option-label:hover { background: #f0f0f0; }
  .option-label input { margin-right: 10px; transform: scale(1.2); }
  
  /* é¸ä¸­ç‹€æ…‹é«˜äº® */
  .option-label.checked { background: #e1f5fe; border-color: #0288d1; color: #000; font-weight: bold; }

  /* ç°½åæ¿ */
  canvas { width: 100%; height: 150px; border: 2px dashed #ccc; border-radius: 4px; touch-action: none; background: #fff; }
  
  /* FAB æŒ‰éˆ• */
  .fab-container { position: fixed; bottom: 25px; right: 25px; display: flex; flex-direction: column; gap: 12px; z-index: 1000; }
  .btn-float { display: flex; align-items: center; justify-content: center; padding: 12px 20px; border-radius: 50px; color: white; font-weight: bold; box-shadow: 0 4px 12px rgba(0,0,0,0.3); cursor: pointer; border: none; font-size: 1rem; transition: transform 0.2s; min-width: 140px; }
  .btn-float:active { transform: scale(0.96); }
  .btn-main { background: linear-gradient(135deg, #27ae60, #2ecc71); } 
  .btn-sub { background: linear-gradient(135deg, #2980b9, #3498db); font-size: 0.9rem; }

  @media (max-width: 600px) {
      .fab-container { bottom: 20px; right: 20px; }
      .btn-float { padding: 10px 15px; font-size: 0.9rem; }
  }
</style>
</head>
<body>

<div class="container">
  <div class="version-tag">v6.0 (æ ¼å¼çµ±ä¸€ç‰ˆ)</div>
  <h2 style="text-align:center; color:#2c3e50;">è·å ´ä¸æ³•ä¾µå®³é é˜²<br>æ•™è‚²è¨“ç·´æˆæ•ˆèª¿æŸ¥è¡¨</h2>
  
  <div class="section">
    <h3>ä¸€ã€å€‹äººæ¦‚æ³èˆ‡åŸºæœ¬è³‡æ–™</h3>
    
    <label class="block-label">(ä¸€) å§“å</label>
    <input type="text" id="empName" placeholder="è«‹è¼¸å…¥å§“å">

    <label class="block-label">(äºŒ) éƒ¨é–€ / å–®ä½</label>
    <select id="q1_unit">
        <option value="">è«‹é¸æ“‡å–®ä½</option>
        <option value="V1">V1</option><option value="V2">V2</option><option value="V3">V3</option>
        <option value="V5">V5</option><option value="V6">V6</option><option value="V7">V7</option>
        <option value="å·¥å‹™">å·¥å‹™</option><option value="è¡ŒéŠ·">è¡ŒéŠ·</option><option value="è²¡æœƒ">è²¡æœƒ</option>
        <option value="é–‹ç™¼">é–‹ç™¼</option><option value="è³‡è¨Š">è³‡è¨Š</option><option value="é‹ç±Œ">é‹ç±Œ</option>
        <option value="æ–°äº‹æ¥­">æ–°äº‹æ¥­</option><option value="ç¸½ç®¡ç†">ç¸½ç®¡ç†</option>
    </select>

    <label class="block-label">å¡«è¡¨æ™‚é–“</label>
    <input type="date" id="evalDate">

    <hr style="margin: 20px 0; border: 0; border-top: 1px dashed #ddd;">

    <label class="block-label">(ä¸‰) ä»»ç”¨é¡åˆ¥ (è·å‹™)</label>
    <input type="text" id="q1_job" placeholder="ä¾‹å¦‚ï¼šå°ˆå“¡ã€å·¥ç¨‹å¸«ã€ä¸»ç®¡...">

    <label class="block-label">(å››) æ€§åˆ¥</label>
    <div class="option-group" style="grid-template-columns: repeat(2, 1fr);">
        <label class="option-label"><input type="radio" name="q1_gender" value="ç”·æ€§">ç”·æ€§</label>
        <label class="option-label"><input type="radio" name="q1_gender" value="å¥³æ€§">å¥³æ€§</label>
    </div>

    <label class="block-label">(äº”) æ•™è‚²ç¨‹åº¦</label>
    <div class="option-group">
        <label class="option-label"><input type="radio" name="q1_edu" value="åœ‹ä¸­(å«ä»¥ä¸‹)">åœ‹ä¸­(å«ä»¥ä¸‹)</label>
        <label class="option-label"><input type="radio" name="q1_edu" value="é«˜ä¸­(é«˜è·)">é«˜ä¸­(é«˜è·)</label>
        <label class="option-label"><input type="radio" name="q1_edu" value="å¤§å­¸(å°ˆç§‘)">å¤§å­¸(å°ˆç§‘)</label>
        <label class="option-label"><input type="radio" name="q1_edu" value="ç ”ç©¶æ‰€(å«)åŠä»¥ä¸Š">ç ”ç©¶æ‰€(å«)åŠä»¥ä¸Š</label>
    </div>
  </div>

  <div class="section">
    <h3>äºŒã€å·¥ä½œå¹´è³‡</h3>
    
    <label class="block-label">(ä¸€) é€²æœ¬å…¬å¸è¿„ä»Šå¹´è³‡</label>
    <div class="option-group">
        <label class="option-label"><input type="radio" name="q2_tenure_comp" value="æœªæ»¿1å¹´">æœªæ»¿1å¹´</label>
        <label class="option-label"><input type="radio" name="q2_tenure_comp" value="1å¹´ä»¥ä¸Š~æœªæ»¿5å¹´">1å¹´ä»¥ä¸Š~æœªæ»¿5å¹´</label>
        <label class="option-label"><input type="radio" name="q2_tenure_comp" value="5å¹´ä»¥ä¸Š~æœªæ»¿9å¹´">5å¹´ä»¥ä¸Š~æœªæ»¿9å¹´</label>
        <label class="option-label"><input type="radio" name="q2_tenure_comp" value="9å¹´ä»¥ä¸Š~æœªæ»¿13å¹´">9å¹´ä»¥ä¸Š~æœªæ»¿13å¹´</label>
        <label class="option-label"><input type="radio" name="q2_tenure_comp" value="13å¹´ä»¥ä¸Š">13å¹´ä»¥ä¸Š</label>
    </div>

    <label class="block-label">(äºŒ) æˆªè‡³ç›®å‰ç‚ºæ­¢æ‚¨å¯¦éš›å¾äº‹ç¾è·å·¥ä½œé¡åˆ¥çš„å¹´è³‡</label>
    <div class="inline-input-group">
        <input type="number" id="q2_role_y" class="inline-input" placeholder="0"> å¹´
        <input type="number" id="q2_role_m" class="inline-input" placeholder="0"> æœˆ
    </div>

    <label class="block-label">(ä¸‰) å¹³å‡æ¯é€±å·¥ä½œæ™‚æ•¸</label>
    <div class="option-group">
        <label class="option-label"><input type="radio" name="q2_hours" value="42å°æ™‚ä»¥ä¸‹">42å°æ™‚ä»¥ä¸‹</label>
        <label class="option-label"><input type="radio" name="q2_hours" value="43~48å°æ™‚">43~48å°æ™‚</label>
        <label class="option-label"><input type="radio" name="q2_hours" value="49~54å°æ™‚">49~54å°æ™‚</label>
        <label class="option-label"><input type="radio" name="q2_hours" value="55å°æ™‚ä»¥ä¸Š">55å°æ™‚ä»¥ä¸Š</label>
    </div>
  </div>

  <div class="section">
    <h3>ä¸‰ã€å·¥ä½œå½¢æ…‹</h3>
    <div class="option-group">
        <label class="option-label"><input type="radio" name="q3_shift" value="å›ºå®šç™½å¤©ç­">å›ºå®šç™½å¤©ç­</label>
        <label class="option-label"><input type="radio" name="q3_shift" value="å›ºå®šå°å¤œç­">å›ºå®šå°å¤œç­</label>
        <label class="option-label"><input type="radio" name="q3_shift" value="å›ºå®šå¤§å¤œç­">å›ºå®šå¤§å¤œç­</label>
        <label class="option-label"><input type="radio" name="q3_shift" value="ä¸‰ç­è¼ªç­åˆ¶">ä¸‰ç­è¼ªç­åˆ¶</label>
        <label class="option-label"><input type="radio" name="q3_shift" value="å›ºå®šç™½å¤©ç­+å€¼ç­">å›ºå®šç™½å¤©ç­+å€¼ç­</label>
        <label class="option-label">
            <input type="radio" name="q3_shift" value="other" id="q3_other_radio">
            å…¶ä»–ï¼š<input type="text" id="q3_other_text" style="width:100px; margin-bottom:0; padding:5px;" onclick="document.getElementById('q3_other_radio').checked=true">
        </label>
    </div>
  </div>

  <div class="section">
    <h3>å››ã€æ›¾ç¶“é­é‡ä¸‹åˆ—çš„æš´åŠ›æ”»æ“Šæƒ…å¢ƒï¼Ÿ(å¯è¤‡é¸)</h3>
    <div class="option-group">
        <label class="option-label"><input type="checkbox" name="q4_violence" value="è·å ´æš´åŠ›">è·å ´æš´åŠ›</label>
        <label class="option-label"><input type="checkbox" name="q4_violence" value="è·å ´éœ¸å‡Œ">è·å ´éœ¸å‡Œ</label>
        <label class="option-label"><input type="checkbox" name="q4_violence" value="å°±æ¥­æ­§è¦–">å°±æ¥­æ­§è¦–</label>
        <label class="option-label"><input type="checkbox" name="q4_violence" value="æ€§é¨·æ“¾">æ€§é¨·æ“¾</label>
        <label class="option-label"><input type="checkbox" name="q4_violence" value="è·Ÿè¹¤é¨·æ“¾">è·Ÿè¹¤é¨·æ“¾</label>
        <label class="option-label">
            <input type="checkbox" name="q4_violence" value="other" id="q4_other_check">
            å…¶ä»–ï¼š<input type="text" id="q4_other_text" style="width:100px; margin-bottom:0; padding:5px;" onclick="document.getElementById('q4_other_check').checked=true">
        </label>
    </div>
  </div>

  <div class="section">
    <h3>äº”ã€å–®ä½æ˜¯å¦æä¾›æœ‰é—œé é˜²è·å ´ä¸æ³•ä¾µå®³ä¹‹è¡›ç”Ÿæ•™è‚²è¨“ç·´ï¼Ÿ</h3>
    <div class="option-group">
        <label class="option-label" style="border-left:5px solid #e74c3c;">
            <input type="checkbox" id="q5_none" value="æœªæ›¾æä¾›" onchange="toggleTrainingNone(this)">
            æœªæ›¾æä¾›ä»»ä½•å·¥ä½œå®‰å…¨è¡›ç”Ÿæ•™è‚²è¨“ç·´ (å…å‹¾å…¶ä»–)
        </label>
        <label class="option-label"><input type="checkbox" name="q5_train" value="äººèº«å®‰å…¨ä¹‹é˜²ç¯„">äººèº«å®‰å…¨ä¹‹é˜²ç¯„</label>
        <label class="option-label"><input type="checkbox" name="q5_train" value="é˜²è­·ç”¨å…·ä¹‹ä½¿ç”¨">é˜²è­·ç”¨å…·ä¹‹ä½¿ç”¨</label>
        <label class="option-label"><input type="checkbox" name="q5_train" value="å±å®³é€šè­˜">å±å®³é€šè­˜</label>
        <label class="option-label"><input type="checkbox" name="q5_train" value="æ³•è¦æ•™è‚²">æ³•è¦æ•™è‚²</label>
        <label class="option-label">
            <input type="checkbox" name="q5_train" value="other" id="q5_other_check">
            å…¶ä»–ï¼š<input type="text" id="q5_other_text" style="width:100px; margin-bottom:0; padding:5px;" onclick="document.getElementById('q5_other_check').checked=true">
        </label>
    </div>
  </div>

  <div class="section">
    <h3>å…­ã€æ•™è‚²è¨“ç·´æ˜¯å¦æœ‰å¹«åŠ©ï¼Ÿ</h3>
    <div class="option-group">
        <label class="option-label"><input type="radio" name="q6_help" value="æ²’å¹«åŠ©">æ²’å¹«åŠ©</label>
        <label class="option-label"><input type="radio" name="q6_help" value="æœ‰é»å¹«åŠ©">æœ‰é»å¹«åŠ©</label>
        <label class="option-label"><input type="radio" name="q6_help" value="æ™®é€š">æ™®é€š</label>
        <label class="option-label"><input type="radio" name="q6_help" value="å¾ˆæœ‰å¹«åŠ©">å¾ˆæœ‰å¹«åŠ©</label>
    </div>
  </div>

  <div class="section">
    <h3>ä¸ƒã€é‡å°ä¸æ³•ä¾µå®³é é˜²ä¹‹å»ºè­°</h3>
    <textarea id="q7_feedback" placeholder="è«‹è¼¸å…¥æ‚¨çš„å»ºè­°..."></textarea>
    
    <label style="margin-top:20px;">å¡«è¡¨äººç°½å <span style="color:red;">(å¿…å¡«)</span>ï¼š</label>
    <canvas id="sigCanvas"></canvas>
    <button onclick="clearSig()" style="margin-top:5px; background:#ccc; border:none; padding:8px 15px; border-radius:4px; cursor:pointer;">æ¸…é™¤é‡ç°½</button>
  </div>
</div>

<div class="fab-container">
    <button class="btn-float btn-sub" onclick="sendEmail()">âœ‰ï¸ å¯„çµ¦è² è²¬äºº</button>
    <button class="btn-float btn-main" onclick="generateReport()">ğŸ“¥ ä¸‹è¼‰èª¿æŸ¥è¡¨</button>
</div>

<script>
const managerEmail = "oceanchen@makalot.com.tw";

// åˆå§‹åŒ–æ—¥æœŸ
document.getElementById('evalDate').valueAsDate = new Date();

// ==========================================
// 1. UI äº’å‹•é‚è¼¯
// ==========================================
// è®“ Radio/Checkbox é»æ“Šæ•´è¡Œéƒ½èƒ½é¸å–
document.querySelectorAll('.option-label').forEach(label => {
    label.addEventListener('click', function(e) {
        if(e.target.tagName !== 'INPUT' && e.target.tagName !== 'TEXTAREA' && e.target.type !== 'text') {
            const input = this.querySelector('input');
            if(input.type === 'radio') {
                input.checked = true;
                const name = input.name;
                document.querySelectorAll(`input[name="${name}"]`).forEach(rb => {
                    rb.closest('.option-label').classList.remove('checked');
                });
                this.classList.add('checked');
            } else {
                input.checked = !input.checked;
                this.classList.toggle('checked', input.checked);
            }
            if(input.name === 'q5_train' && input.checked) {
                const noneCheck = document.getElementById('q5_none');
                if(noneCheck.checked) {
                    noneCheck.checked = false;
                    noneCheck.closest('.option-label').classList.remove('checked');
                }
            }
        }
    });
    const input = label.querySelector('input');
    if(input && input.checked) label.classList.add('checked');
});

// ç¬¬äº”é¡Œï¼šäº’æ–¥é‚è¼¯
function toggleTrainingNone(el) {
    if(el.checked) {
        el.closest('.option-label').classList.add('checked');
        document.querySelectorAll('input[name="q5_train"]').forEach(cb => {
            cb.checked = false;
            cb.closest('.option-label').classList.remove('checked');
        });
        document.getElementById('q5_other_text').value = '';
    } else {
        el.closest('.option-label').classList.remove('checked');
    }
}

// ç°½åæ¿
const canvas = document.getElementById("sigCanvas");
const ctx = canvas.getContext("2d");
function resize() { 
    const ratio = Math.max(window.devicePixelRatio||1, 1);
    canvas.width = canvas.offsetWidth*ratio; canvas.height = canvas.offsetHeight*ratio;
    ctx.scale(ratio,ratio); 
}
window.addEventListener("resize", resize); setTimeout(resize, 500);
let isDrawing = false, hasSigned = false;
function getPos(e) {
    const r = canvas.getBoundingClientRect();
    return { x: (e.touches?e.touches[0].clientX:e.clientX)-r.left, y: (e.touches?e.touches[0].clientY:e.clientY)-r.top };
}
function start(e) { if(e.target==canvas) e.preventDefault(); hasSigned=true; isDrawing=true; ctx.beginPath(); var p=getPos(e); ctx.moveTo(p.x,p.y); }
function move(e) { if(!isDrawing) return; if(e.target==canvas) e.preventDefault(); var p=getPos(e); ctx.lineTo(p.x,p.y); ctx.stroke(); }
function end() { isDrawing=false; }
canvas.addEventListener('mousedown',start); canvas.addEventListener('touchstart',start,{passive:false});
canvas.addEventListener('mousemove',move); canvas.addEventListener('touchmove',move,{passive:false});
canvas.addEventListener('mouseup',end); canvas.addEventListener('touchend',end);
function clearSig() { ctx.clearRect(0,0,canvas.width/window.devicePixelRatio,canvas.height/window.devicePixelRatio); hasSigned=false; }

// ==========================================
// 2. ç²å–æ•¸å€¼
// ==========================================
function getVal(id) { return document.getElementById(id).value; }
function getRadio(name) { 
    const el = document.querySelector(`input[name="${name}"]:checked`);
    if(el && el.value === 'other') {
        if(name === 'q3_shift') return document.getElementById('q3_other_text').value || 'å…¶ä»–';
    }
    return el ? el.value : ''; 
}
function getChecks(name, otherId, otherTextId) {
    let arr = [];
    document.querySelectorAll(`input[name="${name}"]:checked`).forEach(cb => {
        if(cb.value === 'other') {
            arr.push(document.getElementById(otherTextId).value || 'å…¶ä»–');
        } else {
            arr.push(cb.value);
        }
    });
    return arr;
}

// ==========================================
// 3. ç”¢å‡ºå ±å‘Š
// ==========================================
function generateReport() {
    // åŸºæœ¬è³‡æ–™
    const name = getVal('empName');
    const unit = getVal('q1_unit');
    const date = getVal('evalDate');

    // Section 1 å…§å®¹
    const job = getVal('q1_job');
    const gender = getRadio('q1_gender');
    const edu = getRadio('q1_edu');
    
    // Section 2
    const tenureComp = getRadio('q2_tenure_comp');
    const roleY = getVal('q2_role_y');
    const roleM = getVal('q2_role_m');
    const hours = getRadio('q2_hours');
    
    // Section 3
    let shift = getRadio('q3_shift');
    if(shift === 'other') shift = document.getElementById('q3_other_text').value;

    // Section 4
    const violences = getChecks('q4_violence', 'q4_other_check', 'q4_other_text').join('ã€') || "ç„¡";
    
    // Section 5
    let training = "";
    if(document.getElementById('q5_none').checked) {
        training = "æœªæ›¾æä¾›ä»»ä½•è¨“ç·´";
    } else {
        training = getChecks('q5_train', 'q5_other_check', 'q5_other_text').join('ã€') || "æœªå¡«å¯«";
    }

    // Section 6 & 7
    const helpfulness = getRadio('q6_help');
    const feedback = getVal('q7_feedback');

    // é©—è­‰å¿…å¡«
    if(!name || !unit || !job || !hasSigned) { alert("è«‹ç¢ºèªã€Œå§“åã€ã€ã€Œéƒ¨é–€ã€ã€ã€Œè·å‹™ã€åŠã€Œç°½åã€çš†å·²å®Œæˆã€‚"); return; }

    const html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>èª¿æŸ¥è¡¨-${name}</title>
    <style>
        body{font-family:"Microsoft JhengHei", sans-serif; padding:40px; color:#333; max-width:900px; margin:0 auto;}
        .header { text-align: center; border-bottom: 2px solid #000; margin-bottom: 20px; }
        .meta-header { display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: bold; background: #f9f9f9; padding: 15px; border-radius: 8px; border: 1px solid #ddd; }
        table { width: 100%; border-collapse: collapse; margin-top: 5px; }
        td, th { border: 1px solid #000; padding: 10px; vertical-align: top; text-align: left;}
        .bg-gray { background-color: #f0f0f0; font-weight: bold; width: 25%; }
        .sig-section { margin-top: 40px; display: flex; justify-content: flex-end; }
        .sig-img { height: 60px; border-bottom: 1px solid #000; }
    </style></head><body>
    
    <div class="header">
        <h2>è·å ´ä¸æ³•ä¾µå®³é é˜² - å“¡å·¥æ•™è‚²è¨“ç·´æˆæ•ˆèª¿æŸ¥è¡¨</h2>
    </div>

    <div class="meta-header">
        <div>å§“åï¼š${name}</div>
        <div>éƒ¨é–€(å–®ä½)ï¼š${unit}</div>
        <div>å¡«è¡¨æ—¥æœŸï¼š${date}</div>
    </div>
    
    <table>
        <tr>
            <td class="bg-gray">ä¸€ã€å€‹äººæ¦‚æ³</td>
            <td colspan="3">
                ä»»ç”¨é¡åˆ¥(è·å‹™)ï¼š${job}<br>
                æ€§åˆ¥ï¼š${gender}<br>
                æ•™è‚²ç¨‹åº¦ï¼š${edu}
            </td>
        </tr>
        <tr>
            <td class="bg-gray">äºŒã€å·¥ä½œå¹´è³‡</td>
            <td colspan="3">
                å…¬å¸å¹´è³‡ï¼š${tenureComp}<br>
                ç¾è·å¹´è³‡ï¼š${roleY} å¹´ ${roleM} æœˆ<br>
                å¹³å‡é€±å·¥æ™‚ï¼š${hours}
            </td>
        </tr>
        <tr>
            <td class="bg-gray">ä¸‰ã€å·¥ä½œå½¢æ…‹</td>
            <td colspan="3">${shift}</td>
        </tr>
        <tr>
            <td class="bg-gray">å››ã€æ›¾é­é‡æš´åŠ›æƒ…å¢ƒ</td>
            <td colspan="3">${violences}</td>
        </tr>
        <tr>
            <td class="bg-gray">äº”ã€æä¾›ä¹‹è¨“ç·´</td>
            <td colspan="3">${training}</td>
        </tr>
        <tr>
            <td class="bg-gray">å…­ã€æ˜¯å¦æœ‰å¹«åŠ©</td>
            <td colspan="3">${helpfulness || 'æœªå‹¾é¸'}</td>
        </tr>
        <tr>
            <td class="bg-gray">ä¸ƒã€å»ºè­°</td>
            <td colspan="3">${feedback || 'ç„¡'}</td>
        </tr>
    </table>
    
    <div class="sig-section">
        <div style="text-align:center;">
            <span>å¡«è¡¨äººç°½ç« ï¼š</span>
            <img src="${canvas.toDataURL()}" class="sig-img">
        </div>
    </div>

    </body></html>`;

    const blob = new Blob([html], {type: "text/html"});
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `ä¸æ³•ä¾µå®³æ•™è‚²è¨“ç·´å•å·_${unit}_${name}_${date}.html`;
    link.click();
}

function sendEmail() {
    const name = getVal('empName');
    const unit = getVal('q1_unit');
    
    if(!name) { alert("è«‹å…ˆå¡«å¯«å§“å"); return; }

    const subject = `ä¸æ³•ä¾µå®³æ•™è‚²è¨“ç·´å•å·ç¹³äº¤ - ${unit} - ${name}`;
    const body = `è² è²¬äººæ‚¨å¥½ï¼Œé™„ä»¶ç‚ºæˆ‘çš„ä¸æ³•ä¾µå®³æ•™è‚²è¨“ç·´å•å·ï¼Œè«‹æŸ¥æ”¶ã€‚%0D%0Aå¡«è¡¨äººï¼š${name}`;
    window.location.href = `mailto:${managerEmail}?subject=${subject}&body=${body}`;
}
</script>
</body>
</html>
